syntax = "proto3";

package dfs;

service DataNodeService {
  rpc PutChunk(stream PutChunkRequest) returns (PutChunkResponse);
  rpc GetChunk(GetChunkRequest) returns (stream GetChunkResponse);
  rpc DeleteChunk(DeleteChunkRequest) returns (DeleteChunkResponse);
}

// Enhanced chunk operations with replication support
message PutChunkRequest {
  string chunk_id = 1;
  bytes data = 2;
  int32 replica_index = 3;  // Which replica this is (0, 1, 2)
  // Optional: checksum for integrity verification
  string checksum = 4;
}

message PutChunkResponse {
  bool success = 1;
  string error_message = 2;
  // Actual replica index assigned (for verification)
  int32 assigned_replica_index = 3;
}

message GetChunkRequest {
  string chunk_id = 1;
  int32 replica_index = 2;  // Which replica to read from (optional)
}

message GetChunkResponse {
  bytes data = 1;
  int32 replica_index = 2;  // Which replica this data came from
  string checksum = 3;     // For integrity verification
}

message DeleteChunkRequest {
  string chunk_id = 1;
}

message DeleteChunkResponse {
  bool success = 1;
  string error_message = 2;
}
